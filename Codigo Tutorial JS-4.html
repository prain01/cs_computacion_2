<html>
    <head>
        <meta charset="UTF-8">
        <script>
            var estados="s0,s1,s2,sf";
            var alfabeto="a,b,";
            var delta="(s0,a,A)=s0/AA;(s0,a,W)=s0/AW;(s0,b,A)=s4/_;(s4,c,A)=s0/A;(s4,b,A)=s4/_;(s4,a,AA)=s4/_;(s0,c,W)=fin/_";
            //"(s0,a,W)=s1/AW;(s1,a,A)=s1/AA;(s1,a,W)=s1/AW;(s1,b,A)=s1/_;(s2,b,A)=s2/_;(s2,a,W)=s1/AW;(s2,_,W)=sf/_;"
            //palabra de prueba: aabbabaaabbb -->aceptada
            //pero el algoritmo no tiene la funcionalidad de salto espontanero (sin necesidad de procesar ninguna letra
            //salta desde s2 a sf cuando el tope de la pila sea W, en este caso especifico)
            var finales="sf";
            var inicial="s0";
            var pila_inicial="W";
            //para desempilar usar: _
            
            //crear variables para proceso automata con pila
            var transicion=delta.split(";");
            var final=finales.split(",");
            var par=[];
            var resultado=[];
            var nuevotope=[];
            var taux;
            var stopmsg="Proceso Normal";
            var traza="";
            
            //prepara vectores globales para transiciones
            for (var i=0;i<transicion.length;i++){
                taux=transicion[i].split("=");
                par.push(taux[0]);
                resultado.push(taux[1].split("/")[0]);
                nuevotope.push(taux[1].split("/")[1]);
            }

            function procesaTodo(){
                traza="";
                var txArea=document.getElementById('todo');
                var tx=txArea.value;
                var pal=tx.split("\n");
                var out="";
                for(var i=0;i<pal.length;i++){
                    stopmsg="Proceso Normal";
                    traza+="<br><br><u><b>Procesando "+pal[i]+"</b></u>";
                    out+=pal[i]+ " --> "+procesaPalabra(pal[i])+"<br>";
                }
                document.getElementById('salida').innerHTML=out;
                document.getElementById('pasos').innerHTML=traza;
            }


            function procesaPalabra(palabra){
                var letra=palabra.split("");
                var actual=inicial+","+pila_inicial;
                for(var i=0;i<letra.length && actual!='error';i++){
                    traza+="<br> "+letra[i]+" en "+actual;
                    actual=cambiaEstado(letra[i],actual);
                    traza+="--> "+actual;
                }

                traza+="<br>"+stopmsg;
                return final.includes(actual.split(",")[0]);
            }

            function cambiaEstado(letra,estadoComaPila){
                var aux=estadoComaPila.split(",");
                if(aux[1].length<=0){
                    stopmsg="Intenta transicion con pila vacia";
                    return "error";
                }
                var busca='('+aux[0]+','+letra+','+aux[1].charAt(0)+')';
                var k=par.indexOf(busca);
                if(k>=0){   //existe transicion
                    if(nuevotope[k]=='_'){  //desempila
                        return resultado[k]+','+pop(aux[1]);
                    }else{
                        return resultado[k]+','+newtop(aux[1],nuevotope[k]);}
                }   
                else{   //no existe transicion
                    stopmsg="Indeterminacion para "+busca;
                    return "error";
                }
            }

            function newtop(pilaString,tope){
                pilaString=pop(pilaString);
                return tope+pilaString;
            }

            function pop(pilaString){
                return pilaString.substring(1);
            }

            function w(msg){
                document.write(msg);
            }
            
//ocultar/mostrar div
            //segun el estado del checkbox se le asigna el estado 
            //visible o oculto al div (div con id="pasos")
            function mostrar_ocultar_div(traza){
                var pasos =document.getElementById("pasos");
                pasos.style.display=traza.checked ? "block" : "none";
            }
        </script>

    </head>
    <body>
        
        <h3>Automata Empilador</h3>
        Estados={<script>w(estados);</script>}<br>
        Alfabeto={<script>w(alfabeto);</script>}<br>
        Transiciones={<script>w(delta.replace(/;/gi," , "));</script>}<br>
        Finales={<script>w(finales);</script>}<br>
        Inicialess={<script>w(inicial);</script>}<br>
        Palabras a Procesar:<br>
        <table>
            <tr><td>
                <textarea id="todo" cols="40" rows="12">
aaab
aabb
c
-------------
abb
baa
abaab
                </textarea>
            </td>
            <td id="salida" bgcolor="#FFAAAA"></td>
            </tr>
        </table>
        <br>
        <button onclick="procesaTodo()">Procesar</button>
        <!--Cambio para ocultar/mostrar div-->
        
        <!--llama a la funcion mostrar_ocultar_div(this) con 
        parametro=estado del checkbox-->
        <input type="checkbox" id="traza" onclick="mostrar_ocultar_div(this)" >Trazable
        <!--al div se le asigna estado oculto-->
        <div id="pasos" style="display: none"></div>
    </body>
    </html>