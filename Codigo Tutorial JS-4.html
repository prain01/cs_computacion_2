<html>
    <head>
        <meta charset="UTF-8">
        <script>
            var estados="s0,s4,fin";
            var alfabeto="a,b,c";
            var delta="(s0,a,A)=s0/AA;(s0,a,W)=s0/AW;(s0,b,A)=s4/_;(s4,c,A)=s0/A;(s4,b,A)=s4/_;(s4,a,AA)=s4/_;(s0,c,W)=fin/_";
            var finales="s4,fin";
            var inicial="s0";
            var pila_inicial="W";
            //para desempilar usar: _
            
            //crear variables para proceso automata con pila
            var transicion=delta.split0(";");
            var final=finales.split(",");
            var par=[];
            var resultado=[];
            var nuevotope=[];
            var taux;
            var stopmsg="Proceso Normal";
            var traza="";
            
            //prepara vectores globales para transiciones
            for (var i=0;i<transicion.length;i++){
                taux=transicion[i].split("=");
                par.push(taux[0]);
                resultado.push(taux[1].split("/")[0]);
                resultado.push(taux[1].split("/")[1]);
            }

            function procesaTodo(){
                traza="";
                var txArea=document.getElementById('todo');
                var tx=txArea.value;
                var pal=tx.split("\n");
                var out="";
                for(var i=0;i<pal.length;i++){
                    stopmsg="Proceso Normal";
                    traza+="<br><br><u><b>Procesando "+pal[i]+"</b></u>";
                    out+=pal[i]+ " --> "+procesaPalabra(pal[i])+"<br>";
                }
                document.getElementById('salida').innerHTML=out;
                document.getElementById('pasos').innerHTML=traza;
            }


            function procesaPalabraa(palabra){
                var letra=palabra.split("");
                var actual=inicial+","+pila_inicial;
                for(var i=0;i<letra.length && actual!='error';i++){
                    traza+="<br> "+letra[i]+" en "+actual;
                    actual=cambiaEstado(letra[i],actual);
                    traza+="--> "+actual;
                }

                traza+="<br>"+stopmsg;
                return final.includes(actual.split(",")[0]);
            }

            function cambiaEstado(letra,estadoComaPila){
                var aux=estadoComaPila.split(",");
                if(aux[1].length<=0){
                    stopmsg="Intenta transicion con pila vacia";
                    return "error";
                }
                var busca='('+aux[0]+','+letra+','+aux[1].charAt(0)+')';
                var k=par.indexOf(busca);
                if(k>=0){   //existe transicion
                    if(nuevotope[k]=='_'){  //desempila
                        return resultado[k]+','+pop(aux[1]);
                    }else{
                        return resultado[k]+','+newtop(aux[1],nuevotope[k]);}
                }   //no existe transicion
                else{
                    stopmsg="Indeterminacion para "+busca;
                    return "error";
                }
            }

            function newtop(pilaString,tope){
                pilaString=pop(pilaString);
                return tope+pilaString;
            }

            function pop(pilaString){
                return pilaString.substring(1);
            }

            function w(msg){
                document.write(msg);
            }
            

        </script>
    </head>
    <body>
        
        <h3>Automata Empilador</h3>
        Estados={<script>w(estados);</script>}<br>
        Alfabeto={<script>w(alfabeto);</script>}<br>
        Transiciones={<script>w(delta.replace(/;/gi," , "));</script>}<br>
        Finales={<script>w(finales);</script>}<br>
        Inicialess={<script>w(inicial);</script>}<br>
        Palabras a Procesar:<br>
        <table>
            <tr><td>
                <textarea id="todo" cols="40" rows="12">
aaaabbbb
bbbaaa
aaabbb
                </textarea>
            </td>
            <td id="salida" bgcolor="#AAAAFF"></td>
            </tr>
        </table>
        <br>
        <input type="checkbox" id="traza" checked>Trazable
        <button onclick="procesaTodo()">Procesar</button>
        <div id="pasos"></div>
    </body>
    </html>